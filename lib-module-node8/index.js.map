{"version":3,"sources":["../src/index.js"],"names":["Client","RavenClient","levels","mapToSentryLevel","TRACE","DEBUG","INFO","WARNING","ERROR","FATAL","EMERGENCY","createHandler","ravenUrl","getUser","getTags","ravenClient","record","key","level","metadata","extra","error","extraData","originalError","parsedStack","stackTrace","toArray","captureException","logger","user","tags","SentryHandler","minLevel","options","handle"],"mappings":"AAAA,SAASA,UAAUC,WAAnB,QAAsC,OAAtC;AACA,OAAOC,MAAP,MAAmB,oBAAnB;;AAEA,MAAMC,mBAAmB;AACvB,GAACD,OAAOE,KAAR,GAAgB,OADO;AAEvB,GAACF,OAAOG,KAAR,GAAgB,OAFO;AAGvB,GAACH,OAAOI,IAAR,GAAe,MAHQ;AAIvB,GAACJ,OAAOK,OAAR,GAAkB,SAJK;AAKvB,GAACL,OAAOM,KAAR,GAAgB,OALO;AAMvB,GAACN,OAAOO,KAAR,GAAgB,OANO;AAOvB,GAACP,OAAOQ,SAAR,GAAoB;AAPG,CAAzB;;AAUA,MAAMC,gBAAgB,CAACC,QAAD,EAAW,EAAEC,UAAU,MAAM,CAAE,CAApB,EAAsBC,UAAU,MAAM,CAAE,CAAxC,OAAX,KAA+D;AACnF,QAAMC,cAAc,IAAId,WAAJ,CAAgBW,QAAhB,CAApB;;AAEA,SAAOI,UAAU;AACf,UAAM,EAAEC,GAAF,EAAOC,KAAP,EAAcC,QAAd,EAAwBC,KAAxB,KAAkCJ,MAAxC;AACA,QAAIK,QAAQF,YAAYA,SAASE,KAAjC;;AAEA,QAAI,CAACA,KAAL,EAAY;AACV;AACD;;AAED,UAAMC,8BAAiBH,QAAjB,IAA2BC,KAA3B,GAAN;AACA,WAAOE,UAAUD,KAAjB;;AAEA,QAAIA,MAAME,aAAV,EAAyB;AACvB;AACAD,gBAAUE,WAAV,GAAwBH,MAAMI,UAAN,CAAiBC,OAAjB,EAAxB;AACAL,cAAQA,MAAME,aAAd;AACD;;AAEDR,gBAAYY,gBAAZ,CAA6BN,KAA7B,EAAoC;AAClCO,cAAQX,GAD0B;AAElCC,aAAOf,iBAAiBe,KAAjB,KAA2B,OAFA;AAGlCE,aAAOE,SAH2B;AAIlCO,YAAMhB,QAAQG,MAAR,CAJ4B;AAKlCc,YAAMhB,QAAQE,MAAR;AAL4B,KAApC;AAOD,GAxBD;AAyBD,CA5BD;;AA8BA,eAAe,SAASe,aAAT,CAAuBnB,QAAvB,EAAyCoB,QAAzC,EAA2DC,OAA3D,EAAoE;AACjF,OAAKD,QAAL,GAAgBA,QAAhB;AACA,OAAKE,MAAL,GAAcvB,cAAcC,QAAd,EAAwBqB,OAAxB,CAAd;AACD","file":"index.js","sourcesContent":["import { Client as RavenClient } from 'raven';\nimport levels from 'nightingale-levels';\n\nconst mapToSentryLevel = {\n  [levels.TRACE]: 'debug',\n  [levels.DEBUG]: 'debug',\n  [levels.INFO]: 'info',\n  [levels.WARNING]: 'warning',\n  [levels.ERROR]: 'error',\n  [levels.FATAL]: 'fatal',\n  [levels.EMERGENCY]: 'fatal',\n};\n\nconst createHandler = (ravenUrl, { getUser = () => {}, getTags = () => {} } = {}) => {\n  const ravenClient = new RavenClient(ravenUrl);\n\n  return record => {\n    const { key, level, metadata, extra } = record;\n    let error = metadata && metadata.error;\n\n    if (!error) {\n      return;\n    }\n\n    const extraData = { ...metadata, extra };\n    delete extraData.error;\n\n    if (error.originalError) {\n      // error-processor\n      extraData.parsedStack = error.stackTrace.toArray();\n      error = error.originalError;\n    }\n\n    ravenClient.captureException(error, {\n      logger: key,\n      level: mapToSentryLevel[level] || 'error',\n      extra: extraData,\n      user: getUser(record),\n      tags: getTags(record),\n    });\n  };\n};\n\nexport default function SentryHandler(ravenUrl: string, minLevel: number, options) {\n  this.minLevel = minLevel;\n  this.handle = createHandler(ravenUrl, options);\n}\n"]}